---
keywords: fastai
permalink: /Explainer_Notebook2/
description: "This section describes the in detail analysis done in this project."
title: Exlpainer Notebook
toc: false
branch: master
badges: true
comments: false
categories: [explainer notebook, in depth analysis]
image: images/some_folder/your_image.png
hide: true
search_exclude: true
metadata_key1: metadata_value1
metadata_key2: metadata_value2
nb_path: notebooks_final/08_explainer_final.ipynb
layout: page
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks_final\08_explainer_final.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p align="center">
  <img src="https://sm.ign.com/ign_ap/news/g/game-of-th/game-of-thrones-showrunners-reveal-the-night-kings-true-moti_2swf.jpg" />
</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 align = "center"> 1. Motivation </h1><hr>
<p>Game Of Thrones is a very popular series, and achieved the status of being the most watched series to date. The series consist of multiple characters, allegiances, religions, locations and at the same time all these stories play out concurrently. Which makes the information and storytelling at some point quite overwhelming - do all of these characters have a pattern in how they act? Are there any pattern in how their story play out? Could we forecast these events?</p>
<p>We wish to dig into these massive amounts of informations of each character to investigate if we could unveil any underlying pattern which could help all the Game Of Thrones fans understand the story even better. This would include investigation of network patterns, but also if we could find the most important character in each season, and overall in the series. Also to see if we can find any underying communities and thereby see if we can decoded the underlying pattern.</p>
<h2 align = "center">1.1 What is your dataset? </h2><p>Our main dataset is from <a href="https://gameofthrones.fandom.com/wiki/Game_of_Thrones_Wiki">The Game Of Thrones wiki-page</a>, where we have extracted the character pages for all characters present in the Game Of Thrones series. This dataset is restricted to only contain the characters that are stated on the Wiki-page, and when this is compared with the number of characters from the book, the data amount in number of characters is smaller in comparison.</p>
<p>The data for each character are both extracted as a total amount of data across all seasons ie. all the data from each character page, but also based on each season. From the character page some basic attributes were extracted: allegiance, religion, culture, appearances, status and what other characters the given character were linked to, and how often these were linked. The thumbnail image was also extracted for later visualization, and lastly the text was cleaned for the purpose of text analysis later on.</p>
<p>As the wiki-pages are written by other people this could effect the sentiment of the character pages, therefore it was also decided to include an extra data source namely the character dialogoues. A data-source containing clean transcripts from all the seasons and episodes were used, so no data cleaning was needed here besides excluding all the dialogoue of characters that was not found through the wiki-page data.</p>
<p>Lastly, ratings and reviews from IMDB was used for each episode, as it was wished to compare this with the dialogoue. This was found by the use of a python package, which extracted data from IMDB. We did further investigate the possibility to scrape the IMDB webpage for reviews, but later it was found that this was not allowed and therefore we did not further pursue this opportunity.</p>
<p><p align="center">
  <img src="https://assets.datacamp.com/production/project_76/img/got_network.jpeg" />
</p></p>
<h2 align = "center">1.2 Why did you choose this/these particular dataset(s)? </h2><p>The dataset from the Game of Thrones wikipage, was used as this could both deliver information about each character ie. some of their general attributes but also text relating to interactions of the characters but also words describing each character. This could help us understand the interactions between all characters, and hopefully help us understand some of the underlying patterns in the series.</p>
<p>We could investigate the network properties of the series both on an overall level across all seasons but also in each season. Through this we could make an analysis of each season, and investigate how this developed through each season. By investigation of words describing each character, and on the basis of their attributes eg. allegiance, we would perform text and sentiment analysis to see if we could understand the grouping.</p>
<p>As the sentiment of the character pages could be biased by the writer of the page we wanted to find the root source namely the transcripts from the series, and therefore we utilized the dialogoue of all the characters as an second data source. This was done as we thought this could add extra valuable information to understand how the characters were feeling, and furthermore how they were grouped.</p>
<p>Lastly, we added the ratings from IMDB to see if the reviewers was affected by the general mood in the series.</p>
<h2 align = "center">1.3 What was your goal for the end user's experience? </h2><p>The goal of the website is to present nice interactive visualizations that engage the user to explore the data and the Game Of Thrones series. Further, the site should be easy to grasp and understandable also for people without the theoretical knowledge learned in the course. The website contains results presented in different visualizations and tables that the user can dive into, and should be tempted to dive deeper into the analysis and the results. The site should be engaging, and it should not be necessary to visit the site for hours in order to get any insights, though this should be an opportunity.</p>
<p>The website should let the end user explore the complex character interactions from the Game Of Thrones series, and let the user understand some of these patterns, which is explored both through network analysis, text analysis and sentiment analysis. The user should understand which characters are the most important characters in the series but also in each season, and further explore these characters properties. This could include words they use, how the characters feel and who they interact with. The user should feel the urge to dive deeper into this, and should feel confident in what the data contains and can be used for.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 align = "center">2. Data and basic statistics </h1><hr>
<h2 align = "center">2.1 Data extraction, cleaning and pre-processing </h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">urllib</span> 
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">from</span> <span class="nn">nltk.stem</span> <span class="kn">import</span> <span class="n">WordNetLemmatizer</span>
<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>
<span class="kn">import</span> <span class="nn">os</span> 
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">nltk</span> <span class="kn">import</span> <span class="n">FreqDist</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">wordpunct_tokenize</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">imdb</span> <span class="kn">import</span> <span class="n">IMDb</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;stopwords&quot;</span><span class="p">)</span>

<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;punkt&#39;</span><span class="p">)</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;wordnet&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package stopwords to
[nltk_data]     C:\Users\Mikkel\AppData\Roaming\nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
[nltk_data] Downloading package punkt to
[nltk_data]     C:\Users\Mikkel\AppData\Roaming\nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package wordnet to
[nltk_data]     C:\Users\Mikkel\AppData\Roaming\nltk_data...
[nltk_data]   Package wordnet is already up-to-date!
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><h3 align = "center"> 2.1.1 The Game of Thrones Wiki-page &lt;/h4&gt;</p>
<p>The main data set of this project has been extracted from <a href="https://gameofthrones.fandom.com/wiki/Game_of_Thrones_Wiki">the Game of Thrones fan Wikipedia</a>. In order to generate a Game of Thrones network, it is first nescessary to compile a list of characters to build the network on. This was done by, for each season, using the wiki API to extract the cast of the series as seen below.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">api_call</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="c1"># Basic function to call the Wiki-pedia API</span>
    <span class="n">baseurl</span> <span class="o">=</span> <span class="s2">&quot;https://gameofthrones.fandom.com/api.php?&quot;</span>
    <span class="n">action</span> <span class="o">=</span> <span class="s2">&quot;action=query&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;titles=&quot;</span><span class="o">+</span><span class="n">t</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;é&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;prop=revisions&amp;rvprop=content&amp;rvslots=*&quot;</span>
    <span class="n">dataformat</span> <span class="o">=</span><span class="s2">&quot;format=json&quot;</span>

    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&amp;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseurl</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> <span class="n">dataformat</span><span class="p">)</span>

    <span class="n">wikiresponse</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">wikidata</span> <span class="o">=</span> <span class="n">wikiresponse</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">wikitext</span> <span class="o">=</span> <span class="n">wikidata</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">wikitext</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span>



<span class="k">def</span> <span class="nf">get_vals</span><span class="p">(</span><span class="n">nested</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="c1"># Extracts data from a nest dictionary. Taken from:</span>
    <span class="c1">## https://stackoverflow.com/questions/67747851/python-extracting-data-from-nested-dictionary</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nested</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">nested</span> <span class="o">!=</span> <span class="p">[]:</span>   <span class="c1">#non-empty list</span>
        <span class="k">for</span> <span class="n">lis</span> <span class="ow">in</span> <span class="n">nested</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_vals</span><span class="p">(</span><span class="n">lis</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nested</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">nested</span> <span class="o">!=</span> <span class="p">{}:</span>   <span class="c1">#non-empty dict</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">nested</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>   <span class="c1">#(list or dict) in dict</span>
                <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_vals</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nested</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>   <span class="c1">#key found in dict</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nested</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># Base url for the seasons</span>
<span class="n">base_cat</span> <span class="o">=</span> <span class="s2">&quot;Game_of_Thrones_Season_&quot;</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pattern1</span> <span class="o">=</span> <span class="s2">&quot;\[\[(.*?)\]\] as \[\[(.*?)\]\].*&quot;</span> 
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">api_call</span><span class="p">(</span><span class="n">base_cat</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">get_vals</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern1</span><span class="p">,</span> <span class="n">txt</span><span class="p">))</span>
<span class="n">characters</span> <span class="o">=</span> <span class="p">{</span><span class="n">char</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;actor&quot;</span><span class="p">:</span> <span class="n">actor</span><span class="p">,</span>
                <span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="n">char</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">char</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)}</span> 
                <span class="k">for</span> <span class="n">actor</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">names</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using the method above, we generate a dictionary with the game of thrones characters as keys and the actor of the character and the wiki-link as values. In order to extract the character and actor names from the returned txt, we use the regular expression defined as <strong>pattern1</strong>. Looking at the website, it was noticed that the actor and his played role followed the simple syntax of: "[[Actor]] as [[Character]]". So, the regex expression simply looks explicitly for two sets of [[]] seperated by "as" and extracts all characters enclosed by these brackets.</p>
<p>As we now have a compiled list of all characters present in the Game of Thrones series, we now want to extract the character wiki-pages. This is done similarly as above, simply replacing the season URL with the character URL.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">links</span> <span class="o">=</span> <span class="n">get_vals</span><span class="p">(</span><span class="n">characters</span><span class="p">,</span><span class="s1">&#39;link&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">api_call</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;batchcomplete&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error:&#39;</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">get_vals</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">&quot;REDIRECT&quot;</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">((</span><span class="s2">&quot;\[\[(.*)\]\]&quot;</span><span class="p">),</span><span class="n">txt</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">api_call</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">))</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">get_vals</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/work/got/&#39;</span><span class="o">+</span><span class="n">link</span><span class="o">+</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
            <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">text_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It should also be noted, that if the returned text contains "REDIRECT", we perform a new API call to the link specified by the redirect term. Finally, all the returned character pages are saved as <em>.txt</em> files.</p>
<h4 align="center"> Creating the Game of Thrones Network </h4><p>We can now generate the overall Game of Thrones network containing all the listed characters as network nodes. This is done by iterating through all the extracted character <em>.txt</em> files. The whole code chunk can be seen below but is easier understood if seperated into specific parts and purposes.</p>
<p><strong>Extracting character links</strong>:
In order to compute edges for our Game of Thrones network, we iterate through all the generated <em>.txt</em> files and look for any links to other game of thrones characters. This is done by using the following:</p>
<div class="highlight"><pre><span></span><span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;\[\[(.*?)\]\]&quot;</span>
<span class="n">links</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">node_description</span><span class="p">)</span>
<span class="n">links</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">link</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span> <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">char_list</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">final_links</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">links</span><span class="p">):</span>
        <span class="n">final_links</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span><span class="n">link</span><span class="p">,</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>    
<span class="n">G</span><span class="o">.</span><span class="n">add_weighted_edges_from</span><span class="p">(</span><span class="n">final_links</span><span class="p">)</span>
</pre></div>
<p>All links on the Game of Thrones wiki-page are enclosed by double brackets [[link]]. For each saved <em>.txt</em> file, we search for all links in the given file and look up whether this link is a characters in Game of Thrones. Additionally, we also count how many times a character is linked. This count will constitute the given weight of an edge. Finally, all the found links and their respective weight are added to the given node. This is then done for all nodes in the network.</p>
<p><strong>Extracting character attributes</strong>:
On the wiki-page, most of the Game of Thrones characters have a fact box containing generic information such as: allegiance, religion, culture, status, amount of episodes and more. We extract information regarding culture, religion and allegiance using the following regex expression:</p>
<div class="highlight"><pre><span></span><span class="n">culture_pattern</span> <span class="o">=</span> <span class="s1">&#39;((?&lt;=Culture[\s\=\s]</span><span class="si">{1}</span><span class="s1">)|(?&lt;=Culture[\=\s]</span><span class="si">{2}</span><span class="s1">)|(?&lt;=Culture[\s\=\s]</span><span class="si">{3}</span><span class="s1">))\[\[(.*?)\]\]&#39;</span>
<span class="n">religion_pattern</span> <span class="o">=</span> <span class="s1">&#39;((?&lt;=Religion[\s\=\s]</span><span class="si">{1}</span><span class="s1">)|(?&lt;=Religion[\=\s]</span><span class="si">{2}</span><span class="s1">)|(?&lt;=Religion[\s\=\s]</span><span class="si">{3}</span><span class="s1">))\[\[(.*?)\]\]&#39;</span>
<span class="n">allegiance_pattern</span> <span class="o">=</span> <span class="s1">&#39;((?&lt;=Allegiance[\s\=\s]</span><span class="si">{1}</span><span class="s1">)|(?&lt;=Allegiance[\=\s]</span><span class="si">{2}</span><span class="s1">)|(?&lt;=Allegiance[\s\=\s]</span><span class="si">{3}</span><span class="s1">))\[\[(.*?)\]\]&#39;</span>
</pre></div>
<p>The above regex expressions contains three cases of different positive lookbehinds. The positive lookbehind is expressed using <em>?&lt;=</em> and simply looks for the given attribute, i.e. Culture for instance. The wiki-page uses three different formats in their textboxes: <em>"Culture = "</em>, <em>"Culture= "</em> or <em>"Culture ="</em> which is the reasoning for the use of three different positive lookbehind cases. If any of these positive lookbehinds match we extract the given information enclosed in [[]]. To sum it up, we only extract information enclosed in [[]] if these brackets are preceded by a match of one of the three different cases of positive lookbehind. We extract information regarding Status and number of Apperances in a similair way.</p>
<p><strong>Minor pre-processing of extracted attributes</strong>
There is some inconsistencies regarding naming on the wiki-pages. For instance, both <em>Andal</em> and <em>Andals</em> is used regarding characters culture. This is handled simply by the use of if-statements as seen below. Other inconsistencies are handled similarly.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">culture</span> <span class="o">==</span> <span class="s1">&#39;Andal&#39;</span><span class="p">:</span>
        <span class="n">culture</span> <span class="o">=</span> <span class="s1">&#39;Andals&#39;</span>
</pre></div>
<p><strong>Extraction of thumbnail and formatting of text for network application</strong>
In order to extract links to thumbnail images for the network app seen on the webpage, we made use of the <code>python</code> library <code>BeautifulSoup</code>. This is done by parsing the html code of the given character site, and looking for the keyword <em>img</em> of class <em>pi-image-thumbnail</em> and extracting the <em>src</em> link. This extracted image link is then added to the network as an attribute for the use of the network app.</p>
<p>Similarly, the extracted character name, attributes, most used words and a link to the characters' wiki-page is also added to the network as a string under the attribute <em>text</em>. This is also for the use of the network app. The network app will be further explained in Section 3.1 and how the most used words are found is explained in Section 3.2.</p>
<p>Below is the used code for creating the compiled Game of Thrones Network and the helper functions to extract image thumbnails for the network app.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">getdata</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
<span class="k">def</span> <span class="nf">get_img</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">htmldata</span> <span class="o">=</span> <span class="n">getdata</span><span class="p">(</span><span class="s2">&quot;https://gameofthrones.fandom.com/wiki/&quot;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">htmldata</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;pi-image-thumbnail&quot;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">char_list_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;../data/got_cleaned/&quot;</span><span class="p">)]</span>

<span class="n">char_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">char_names_cap</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">char_list_all</span><span class="p">:</span>
    <span class="n">char_names_cap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
    <span class="n">char</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">char_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">))</span>
    <span class="n">char_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
<span class="n">stop_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">char_names</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">clean_text</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">charlist</span><span class="p">):</span>    
    <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="n">word_tokens</span> <span class="o">=</span> <span class="n">wordpunct_tokenize</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
    
    <span class="n">filtered_sentence</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">word_tokens</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">]</span>


    <span class="n">wnlet</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">wnlet</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">filtered_sentence</span><span class="p">]</span> 
    <span class="k">return</span> <span class="n">words</span>
    
<span class="k">def</span> <span class="nf">tf_idf_func</span><span class="p">():</span> 
    <span class="n">char_pages</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">characters</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;../data/got_cleaned/&quot;</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">characters</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../data/got_cleaned/&#39;</span><span class="o">+</span><span class="n">char</span><span class="o">+</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">char_pages</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">txt</span>
    <span class="n">char_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">char</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">characters</span><span class="p">]</span>
    <span class="c1">#Create space for dict:</span>
    <span class="n">tc_dict_char</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">l_dict_char</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">wnlet</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>

    <span class="c1">#for com in top5_com:</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">char_list</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">char_pages</span><span class="p">[</span><span class="n">char</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">word_tokens</span> <span class="o">=</span> <span class="n">wordpunct_tokenize</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
        
        <span class="n">filtered_sentence</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">word_tokens</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">]</span>

        <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">wnlet</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">filtered_sentence</span><span class="p">]</span> 
        <span class="n">l_dict_char</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
        <span class="c1">#Compute TC for the community words:</span>
        <span class="n">tc_dict_char</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="o">=</span> <span class="n">FreqDist</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

    <span class="c1"># Find all unique words</span>
    <span class="n">unique_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">tc_dict_char</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>

    <span class="c1"># Calculate idf</span>
    <span class="n">idf</span> <span class="o">=</span> <span class="p">{</span><span class="n">word</span><span class="p">:</span> 
                <span class="c1">#Find in how many documents that each word is present:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tc_dict_char</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">([</span><span class="n">tf</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">tf</span> <span class="ow">in</span> <span class="n">tc_dict_char</span><span class="o">.</span><span class="n">items</span><span class="p">()]))</span> 
                <span class="c1">#Iterate through unique words:</span>
                <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">unique_words</span>
        <span class="p">}</span>

    <span class="c1">#Create dict for tf-idf values:</span>
    <span class="n">tf_idf_char_page</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1">#Iterate through communities:</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">tc_dict_char</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">tf_idf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1">#Iterate through each word in each community:</span>
        <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">tf_value</span> <span class="ow">in</span> <span class="n">tc_dict_char</span><span class="p">[</span><span class="n">char</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1">#Extract IDF</span>
            <span class="n">idf_value</span> <span class="o">=</span> <span class="n">idf</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
            <span class="c1">#Compute TF-IDF</span>
            <span class="n">tf_idf</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">idf_value</span><span class="o">*</span><span class="n">tf_value</span><span class="o">/</span><span class="n">l_dict_char</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
        <span class="n">tf_idf_char_page</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf_idf</span>    
    <span class="k">return</span> <span class="n">tf_idf_char_page</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;../data/got/&quot;</span><span class="p">)</span>
<span class="n">char_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span> <span class="c1"># List of all characters </span>


<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span> <span class="c1">#Create empty Directed Graph Object</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="c1"># Iterating through all the saved .txt files for characters</span>

    <span class="n">tf_idf_char</span> <span class="o">=</span> <span class="n">tf_idf_func</span><span class="p">()</span> <span class="c1"># For computation of most used words</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../data/got/&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">node_description</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="c1"># read in current .txt file</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.txt&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># name of current character</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Royal_Steward&quot;</span><span class="p">:</span> <span class="c1">#Special case</span>
        <span class="k">continue</span> 
    <span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;\[\[(.*?)\]\]&quot;</span> <span class="c1"># Pattern for finding links to other characters in the text file</span>
    <span class="n">links</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">node_description</span><span class="p">)</span>

    <span class="c1"># Extracting only links to other characters and count of how many times a character is linked.</span>
    <span class="n">links</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">link</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span> <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">char_list</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Regex expression for extracting character attributes</span>
    <span class="n">culture_pattern</span> <span class="o">=</span> <span class="s1">&#39;((?&lt;=Culture[\s\=\s]</span><span class="si">{1}</span><span class="s1">)|(?&lt;=Culture[\=\s]</span><span class="si">{2}</span><span class="s1">)|(?&lt;=Culture[\s\=\s]</span><span class="si">{3}</span><span class="s1">))\[\[(.*?)\]\]&#39;</span>
    <span class="n">religion_pattern</span> <span class="o">=</span> <span class="s1">&#39;((?&lt;=Religion[\s\=\s]</span><span class="si">{1}</span><span class="s1">)|(?&lt;=Religion[\=\s]</span><span class="si">{2}</span><span class="s1">)|(?&lt;=Religion[\s\=\s]</span><span class="si">{3}</span><span class="s1">))\[\[(.*?)\]\]&#39;</span>
    <span class="n">allegiance_pattern</span> <span class="o">=</span> <span class="s1">&#39;((?&lt;=Allegiance[\s\=\s]</span><span class="si">{1}</span><span class="s1">)|(?&lt;=Allegiance[\=\s]</span><span class="si">{2}</span><span class="s1">)|(?&lt;=Allegiance[\s\=\s]</span><span class="si">{3}</span><span class="s1">))\[\[(.*?)\]\]&#39;</span>

    <span class="n">status</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\|.*Status.*\[\[.*\|(.*?)\]\]&quot;</span><span class="p">,</span><span class="n">node_description</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\|.*Status.*\[\[.*\|(.*?)\]\]&quot;</span><span class="p">,</span><span class="n">node_description</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span> 
    <span class="n">appearances</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\|.*Appearances.* (\d+)&quot;</span><span class="p">,</span> <span class="n">node_description</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\|.*Appearances.* (\d+)&quot;</span><span class="p">,</span> <span class="n">node_description</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    
    <span class="n">allegiance</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">allegiance_pattern</span><span class="p">,</span> <span class="n">node_description</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">allegiance_pattern</span><span class="p">,</span> <span class="n">node_description</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">allegiance</span> <span class="o">=</span> <span class="n">allegiance</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">allegiance</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="n">allegiance</span>
    <span class="n">allegiance</span> <span class="o">=</span> <span class="n">allegiance</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">allegiance</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="n">allegiance</span>
    
    <span class="n">culture</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">culture_pattern</span><span class="p">,</span> <span class="n">node_description</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">culture_pattern</span><span class="p">,</span> <span class="n">node_description</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">culture</span> <span class="o">=</span> <span class="n">culture</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">culture</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="n">culture</span>
    <span class="n">culture</span> <span class="o">=</span> <span class="n">culture</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">culture</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="n">culture</span>

    <span class="n">religion</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">religion_pattern</span><span class="p">,</span> <span class="n">node_description</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">religion_pattern</span><span class="p">,</span> <span class="n">node_description</span><span class="p">))</span> <span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span> 
    <span class="n">religion</span> <span class="o">=</span> <span class="n">religion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">religion</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="n">religion</span>
    <span class="n">religion</span> <span class="o">=</span> <span class="n">religion</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">religion</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="n">religion</span>
    
    <span class="c1">#Special cases</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Tommen_Baratheon&#39;</span><span class="p">:</span>
        <span class="n">allegiance</span> <span class="o">=</span> <span class="s1">&#39;House Baratheon of King</span><span class="se">\&#39;</span><span class="s1">s Landing&#39;</span>

    <span class="k">if</span> <span class="n">culture</span> <span class="o">==</span> <span class="s1">&#39;Andal&#39;</span><span class="p">:</span>
        <span class="n">culture</span> <span class="o">=</span> <span class="s1">&#39;Andals&#39;</span>
    <span class="k">if</span> <span class="n">culture</span> <span class="o">==</span> <span class="s1">&#39;Valyrian&#39;</span><span class="p">:</span>
        <span class="n">culture</span> <span class="o">=</span> <span class="s1">&#39;Valyrians&#39;</span>

    <span class="k">if</span> <span class="n">allegiance</span> <span class="o">==</span> <span class="s1">&#39;King of the Andals and the First Men&#39;</span><span class="p">:</span>
        <span class="n">allegiance</span> <span class="o">=</span> <span class="s1">&#39;King of the Andals, the Rhoynar, and the First Men&#39;</span>

    <span class="k">if</span> <span class="n">religion</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">religion</span> <span class="o">=</span> <span class="s2">&quot;No known religion&quot;</span>
    
    <span class="c1"># Text attribute for network app</span>
    <span class="n">name_for_text</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_for_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span><span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">name_for_text</span> <span class="o">=</span> <span class="n">name_for_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">name_for_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;The selected character: &quot;</span> <span class="o">+</span> <span class="n">name_for_text</span> <span class="o">+</span> <span class="s2">&quot; has the following attributes: &quot;</span><span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    - Allegiance: &quot;</span> <span class="o">+</span> <span class="n">allegiance</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    - Religion: &quot;</span> <span class="o">+</span> <span class="n">religion</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    - Culture: &quot;</span><span class="o">+</span><span class="n">culture</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Most used words by &quot;</span> <span class="o">+</span> <span class="n">name_for_text</span> <span class="o">+</span> <span class="s2">&quot; are: &quot;</span> <span class="o">+</span>  \
            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tf_idf_char</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]])</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Link to character page are: https://gameofthrones.fandom.com/wiki/&quot;</span><span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
    
    <span class="c1"># Thumbnail image for network app</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">thumbnail</span> <span class="o">=</span> <span class="n">get_img</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    
    <span class="k">except</span><span class="p">:</span>
        <span class="n">site</span> <span class="o">=</span> <span class="s1">&#39;Iron_Throne&#39;</span>
        <span class="n">thumbnail</span> <span class="o">=</span> <span class="n">get_img</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>

    <span class="c1"># Add given character as a network node with the found attributes</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span> <span class="s2">&quot;appearances&quot;</span><span class="p">:</span> <span class="n">appearances</span><span class="p">,</span> <span class="s2">&quot;culture&quot;</span><span class="p">:</span><span class="n">culture</span><span class="p">,</span>
                    <span class="s1">&#39;allegiance&#39;</span><span class="p">:</span> <span class="n">allegiance</span><span class="p">,</span><span class="s2">&quot;religion&quot;</span><span class="p">:</span> <span class="n">religion</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span> <span class="p">:</span> <span class="n">text</span><span class="p">,</span> <span class="s2">&quot;thumbnail&quot;</span><span class="p">:</span> <span class="n">thumbnail</span><span class="p">})</span>
    
    <span class="c1"># Compiling the found links into network edges with weights = counts of links</span>
    <span class="n">final_links</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">links</span><span class="p">):</span>
            <span class="n">final_links</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span><span class="n">link</span><span class="p">,</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>    
    <span class="n">G</span><span class="o">.</span><span class="n">add_weighted_edges_from</span><span class="p">(</span><span class="n">final_links</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 align = "center"> Creating the season Networks </h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In order to create networks only for a given season, we use a similair approach as the one to create the overall network. On most character pages on the Game Of Thrones wiki, there is subsections stating their story progression for each season. This information is used in order to create networks for each season.</p>
<p>We start out by creating a nested dictionary that for each season holds a dictionary with characters, respective actor and wiki-page links. We extract characters exactly as when creating the overall network with the only difference being that this is done for each season.</p>
<p>The code for this can be seen below.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">names</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">pattern1</span> <span class="o">=</span> <span class="s2">&quot;\[\[(.*?)\]\] as \[\[(.*?)\]\].*&quot;</span> 
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">api_call</span><span class="p">(</span><span class="n">base_cat</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">get_vals</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern1</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
    <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">char</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;actor&quot;</span><span class="p">:</span> <span class="n">actor</span><span class="p">,</span>
                <span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="n">char</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">char</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)}</span> 
                <span class="k">for</span> <span class="n">actor</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We now need to extract the text for the characters. This is done by iterating through the respective seasons, utilizing the just before created dictionary containing all characters present for a given season. The character links are extracted from the dictionary and using the wiki-api the character webpage is extracted as well. The relevant text for a given season is extracted by splitting the text as seen below. Again, the subsections of seasons are not consistently using the same format hence the many different if-statements.</p>
<p>The extracted text snippet for each season for a given character is then saved as a <em>.txt</em> file.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">links</span> <span class="o">=</span> <span class="n">get_vals</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39;link&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">api_call</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;batchcomplete&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error:&#39;</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">get_vals</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span><span class="p">(</span><span class="s2">&quot;REDIRECT&quot;</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">):</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">((</span><span class="s2">&quot;\[\[(.*)\]\]&quot;</span><span class="p">),</span><span class="n">txt</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">api_call</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">))</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">get_vals</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;===[[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]]===&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;===[[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]]===&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;===[[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]] ===&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;===[[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]] ===&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=== [[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]]===&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=== [[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]]===&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;===[[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]]  ===&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;===[[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]]  ===&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;===  [[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]]===&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;===  [[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]]===&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;===  [[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]] ===&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;===  [[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]] ===&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=== [[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]]  ===&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=== [[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]]  ===&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;===  [[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]]  ===&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;===  [[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]]  ===&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=== [[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]] ===&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=== [[Game of Thrones Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;|Season &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]] ===&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="k">continue</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;==&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../data/got2/s&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">link</span><span class="o">+</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
                <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="n">text_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We now know all characters for a given season and have extracted the relevant part of their character page. Hence, we can, again, create the networks using the almost the same approach as when creating the overall Game of Thrones network but using the seasonal character texts instead. Instead of extracting character attributes again using regex expression we utilize that this information is already stored in the overall Game of Thrones network instead.</p>
<p>One minor tweak for how we create these seasonal networks is, that a lot of the character references in the seasonal text files are not referenced by links but simply by their first name. In order to take this into account we altered the way we extracted character links slightly. Instead of using regex to match for a certain syntax of links, we simply used regex to search through the text for all character names: both first name and first name + last name.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">G_raw</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">read_gpickle</span><span class="p">(</span><span class="s2">&quot;../data/got_G.gpickle&quot;</span><span class="p">)</span>

<span class="c1"># Create attribute dict for seasonal networks from the overall network</span>
<span class="n">attribute_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">G_raw</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="n">attribute_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribute</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">char_list_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;../data/got_cleaned/&quot;</span><span class="p">)]</span>

<span class="n">char_names_cap</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># List of all characters</span>
<span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">char_list_all</span><span class="p">:</span>
    <span class="n">char_names_cap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">tf_idf_season</span> <span class="o">=</span> <span class="n">tf_idf_func</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c1"># Computation of most used words</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;../data/got2/s&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="c1"># List of all character files for a given season</span>
    <span class="n">char_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span> <span class="c1">#List of all characters</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span> <span class="c1"># Create Directed Graph Object</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="c1">#Iterate through character files for a given season</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../data/got2/s&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">node_description</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">name_char</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.txt&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Special case</span>
        <span class="k">if</span> <span class="n">name_char</span> <span class="o">==</span> <span class="s2">&quot;Royal_Steward&quot;</span><span class="p">:</span>
            <span class="k">continue</span> 
        
        <span class="c1">#pattern = &quot;\[\[(.*?)\]\]&quot; # Pattern for extracting links</span>
        <span class="c1"># links = re.findall(pattern, node_description)</span>

        <span class="c1">#Extract character links by searching through txt file for character names.</span>
        <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">char_names_cap</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">node_description</span><span class="p">))</span> <span class="o">&gt;</span><span class="mi">0</span> <span class="p">:</span>
                <span class="n">links</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">node_description</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_description</span><span class="p">))</span> <span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">tmp_link</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_description</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_link</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">node_description</span><span class="p">)):</span>
                        <span class="n">links</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_link</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">node_description</span><span class="p">))))</span>

        <span class="c1"># Count of each unique link</span>
        <span class="n">links</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">link</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span> <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">char_list</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># print(name_char)</span>

        <span class="c1"># Saving attributes for network app</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">attribute_dict</span><span class="p">[</span><span class="n">name_char</span><span class="p">]</span>  
        <span class="n">name_for_text</span> <span class="o">=</span> <span class="n">name_char</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_for_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span><span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">name_for_text</span> <span class="o">=</span> <span class="n">name_for_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">name_for_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;The selected character: &quot;</span> <span class="o">+</span> <span class="n">name_for_text</span> <span class="o">+</span> <span class="s2">&quot; has the following attributes: &quot;</span><span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    - Allegiance: &quot;</span> <span class="o">+</span> <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;allegiance&#39;</span><span class="p">]</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    - Religion: &quot;</span> <span class="o">+</span> <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;religion&#39;</span><span class="p">]</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    - Culture: &quot;</span><span class="o">+</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;culture&#39;</span><span class="p">]</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Most used words by &quot;</span> <span class="o">+</span> <span class="n">name_for_text</span> <span class="o">+</span> <span class="s2">&quot; are: &quot;</span> <span class="o">+</span>  \
            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tf_idf_season</span><span class="p">[</span><span class="n">name_char</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]])</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Link to character page are: https://gameofthrones.fandom.com/wiki/&quot;</span><span class="o">+</span> <span class="n">name_char</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;thumbnail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_img</span><span class="p">(</span><span class="n">name_char</span><span class="p">)</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;wordcloud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Create node for given character with extracted attributes</span>
        <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">name_char</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>
        <span class="c1"># Add edges to node</span>
        <span class="n">final_links</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">links</span><span class="p">):</span>
                <span class="n">final_links</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name_char</span><span class="p">,</span><span class="n">link</span><span class="p">,</span><span class="n">counts</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>    
        <span class="n">G</span><span class="o">.</span><span class="n">add_weighted_edges_from</span><span class="p">(</span><span class="n">final_links</span><span class="p">)</span>
    <span class="c1"># Save .gpickle file containing the network.</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">write_gpickle</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s2">&quot;../data/got_G_s&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.gpickle&quot;</span><span class="p">)</span>
        
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 align = "center"> 2.1.2 The Dialogue of Game of Thrones </h3><p>The second data set used in this project is all the dialogue in the Game of Thrones series. This data set can be found <a href="https://raw.githubusercontent.com/jeffreylancaster/game-of-thrones/master/data/script-bag-of-words.json">here</a>. This data set contains, for each episode in the series, the episode name and all the dialogue for the given episode. As this data is already in <code>.json</code> format it's simply loaded in, and we create a dictionary of characters and all their dialogue throughout the show.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/jeffreylancaster/game-of-thrones/master/data/script-bag-of-words.json&quot;</span><span class="p">)</span>

<span class="n">diag</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">char_diag</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">diag</span><span class="p">:</span>
    <span class="n">episode</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;episodeNum&#39;</span><span class="p">]</span>
    <span class="n">season</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;seasonNum&#39;</span><span class="p">]</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;episodeTitle&#39;</span><span class="p">]</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">textObj</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">char_diag</span><span class="p">:</span>
            <span class="n">char_diag</span><span class="p">[</span><span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">char_diag</span><span class="p">[</span><span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>No pre-processing was needed for this dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 align = "center"> 2.1.2 IMBd ratings and reviews </h3><p>The last data set we utilized is the episodes of the show IMDb rating and reviews. This was extracted using the python library <a href="https://imdbpy.github.io/">IMDbPY</a>. This data contains the average ratings of each episode and demographic information for each reviewer such as gender and age. In order to utilize the <code>IMDbPY</code> package, the IMDb ID for each episode was needed. This was extracted manually:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imdb_ids</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;season 1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1480055&quot;</span><span class="p">,</span> <span class="s2">&quot;1668746&quot;</span><span class="p">,</span> <span class="s2">&quot;1829962&quot;</span><span class="p">,</span> <span class="s2">&quot;1829963&quot;</span><span class="p">,</span><span class="s2">&quot;1829964&quot;</span><span class="p">,</span><span class="s2">&quot;1837862&quot;</span><span class="p">,</span><span class="s2">&quot;1837863&quot;</span><span class="p">,</span><span class="s2">&quot;1837864&quot;</span><span class="p">,</span><span class="s2">&quot;1851398&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;1851397&quot;</span><span class="p">],</span>
            <span class="s1">&#39;season 2&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1971833&quot;</span><span class="p">,</span><span class="s2">&quot;2069318&quot;</span><span class="p">,</span><span class="s2">&quot;2070135&quot;</span><span class="p">,</span><span class="s2">&quot;2069319&quot;</span><span class="p">,</span><span class="s2">&quot;2074658&quot;</span><span class="p">,</span><span class="s2">&quot;2085238&quot;</span><span class="p">,</span><span class="s2">&quot;2085239&quot;</span><span class="p">,</span><span class="s2">&quot;2085240&quot;</span><span class="p">,</span><span class="s2">&quot;2084342&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;2112510&quot;</span><span class="p">],</span>
            <span class="s1">&#39;season 3&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2178782&quot;</span><span class="p">,</span><span class="s2">&quot;2178772&quot;</span><span class="p">,</span><span class="s2">&quot;2178802&quot;</span><span class="p">,</span><span class="s2">&quot;2178798&quot;</span><span class="p">,</span><span class="s2">&quot;2178788&quot;</span><span class="p">,</span><span class="s2">&quot;2178812&quot;</span><span class="p">,</span><span class="s2">&quot;2178814&quot;</span><span class="p">,</span><span class="s2">&quot;2178806&quot;</span><span class="p">,</span><span class="s2">&quot;2178784&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;2178796&quot;</span><span class="p">],</span>
            <span class="s1">&#39;season 4&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2816136&quot;</span><span class="p">,</span><span class="s2">&quot;2832378&quot;</span><span class="p">,</span><span class="s2">&quot;2972426&quot;</span><span class="p">,</span><span class="s2">&quot;2972428&quot;</span><span class="p">,</span><span class="s2">&quot;3060856&quot;</span><span class="p">,</span><span class="s2">&quot;3060910&quot;</span><span class="p">,</span><span class="s2">&quot;3060876&quot;</span><span class="p">,</span><span class="s2">&quot;3060782&quot;</span><span class="p">,</span><span class="s2">&quot;3060858&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;3060860&quot;</span><span class="p">],</span> 
            <span class="s1">&#39;season 5&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;3658012&quot;</span><span class="p">,</span><span class="s2">&quot;3846626&quot;</span><span class="p">,</span><span class="s2">&quot;3866836&quot;</span><span class="p">,</span><span class="s2">&quot;3866838&quot;</span><span class="p">,</span><span class="s2">&quot;3866840&quot;</span><span class="p">,</span><span class="s2">&quot;3866842&quot;</span><span class="p">,</span><span class="s2">&quot;3866846&quot;</span><span class="p">,</span><span class="s2">&quot;3866850&quot;</span><span class="p">,</span><span class="s2">&quot;3866826&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;3866862&quot;</span><span class="p">],</span>
            <span class="s1">&#39;season 6&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;3658014&quot;</span><span class="p">,</span><span class="s2">&quot;4077554&quot;</span><span class="p">,</span><span class="s2">&quot;4131606&quot;</span><span class="p">,</span><span class="s2">&quot;4283016&quot;</span><span class="p">,</span><span class="s2">&quot;4283028&quot;</span><span class="p">,</span><span class="s2">&quot;4283054&quot;</span><span class="p">,</span><span class="s2">&quot;4283060&quot;</span><span class="p">,</span><span class="s2">&quot;4283074&quot;</span><span class="p">,</span><span class="s2">&quot;4283088&quot;</span><span class="p">,</span><span class="s2">&quot;4283094&quot;</span><span class="p">],</span>
            <span class="s1">&#39;season 7&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;5654088&quot;</span><span class="p">,</span><span class="s2">&quot;5655178&quot;</span><span class="p">,</span><span class="s2">&quot;5775840&quot;</span><span class="p">,</span><span class="s2">&quot;5775846&quot;</span><span class="p">,</span><span class="s2">&quot;5775854&quot;</span><span class="p">,</span><span class="s2">&quot;5775864&quot;</span><span class="p">,</span><span class="s2">&quot;5775874&quot;</span><span class="p">,],</span> 
            <span class="s1">&#39;season 8&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;5924366&quot;</span><span class="p">,</span><span class="s2">&quot;6027908&quot;</span><span class="p">,</span><span class="s2">&quot;6027912&quot;</span><span class="p">,</span><span class="s2">&quot;6027914&quot;</span><span class="p">,</span><span class="s2">&quot;6027916&quot;</span><span class="p">,</span><span class="s2">&quot;6027920&quot;</span><span class="p">]</span>
            <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, we initiate an instance of the IMDb class and iterate through all the episode IDs listed above. We then extract the reviews for each episode and the rating votes. Unfortunately, using this method we were limited to only recieve 25 reviews for each episode. The extracted information is then stored in a dictionary and saved as a <em>.json</em> file as can be seen below.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ia</span> <span class="o">=</span> <span class="n">IMDb</span><span class="p">()</span>
<span class="c1">#Extract reviews:</span>
<span class="n">imdb_reviews</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">season</span><span class="p">,</span> <span class="n">episodes</span> <span class="ow">in</span> <span class="n">imdb_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">imdb_reviews</span><span class="p">[</span><span class="n">season</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">episodes</span><span class="p">:</span>
        <span class="n">reviews</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">get_movie_reviews</span><span class="p">(</span><span class="n">episode</span><span class="p">)</span>
        <span class="n">votes</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">get_movie_vote_details</span><span class="p">(</span><span class="n">episode</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;reviews&#39;</span><span class="p">]))</span>
        <span class="n">imdb_reviews</span><span class="p">[</span><span class="n">season</span><span class="p">][</span><span class="n">episode</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reviews&quot;</span> <span class="p">:</span> <span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;reviews&#39;</span><span class="p">],</span>
                                        <span class="s2">&quot;ratings&quot;</span> <span class="p">:</span> <span class="n">votes</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../data/imdb_reviews.json&#39;</span><span class="p">,</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">imdb_reviews</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Again, no pre-processing of this data was needed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 align = "center">2.2 Basic statistics </h2><p>In this section we are going to investigate the basic statistics of the Game Of Thrones network build on the full data from the wiki-pages which can be found <a href="https://github.com/MikkelMathiasen23/GameOfThrones_Network/raw/master/data/got_G.gpickle">here</a>. Further, are we going to investigate the properties of the Game Of Thrones dialogoue which can be found <a href="https://raw.githubusercontent.com/jeffreylancaster/game-of-thrones/master/data/script-bag-of-words.json">here</a>. Lastly, we are going to investigate the reviews and ratings data from IMDB which were gathered using a python package. The data can be found <a href="https://github.com/MikkelMathiasen23/GameOfThrones_Network/raw/master/data/imdb_reviews.json">here</a>.</p>
<p>Each of these exploratory analysis are going to have a subsection in order to make it easier to find it in this notebook.</p>
<h3 align = "center"> 2.2.1 Wiki-page data </h3><p>We are going to start out by loading the pickle file containing the network and all its attributes. The network contains the edges between all characters, and each node which are representing a character contains five attributes: status, appearances, culture, allegiance and religion which we are going to investigate further.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">read_gpickle</span><span class="p">(</span><span class="s2">&quot;../data/got_G.gpickle&quot;</span><span class="p">)</span>

<span class="c1">#Make space in a property dict for the values:</span>
<span class="n">property_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;appearances&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;culture&quot;</span> <span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;allegiance&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;religion&quot;</span> <span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
<span class="c1">#Allocate space for characters and define attributes: </span>
<span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;appearances&quot;</span><span class="p">,</span> <span class="s2">&quot;culture&quot;</span><span class="p">,</span> <span class="s2">&quot;allegiance&quot;</span><span class="p">,</span> <span class="s2">&quot;religion&quot;</span><span class="p">]</span>
<span class="n">characters</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First are we going to investigate the number of characters and edges in the network.</p>
<p>Next, we are going to look into how the characters are distributed across the different allegiances, religions, cultures. How many characters die through the series, and how often does the characters occur.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The network contains: </span><span class="si">{</span><span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span><span class="si">}</span><span class="s1"> nodes and </span><span class="si">{</span><span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span><span class="si">}</span><span class="s1"> number of edges.&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The network contains: 162 nodes and 3085 number of edges.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span> 
    <span class="c1">#Save the character name</span>
    <span class="n">node_name</span> <span class="o">=</span> <span class="n">x</span>
    <span class="c1">#Append name to save all names.</span>
    <span class="n">characters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>

    <span class="c1">#For each of the five attributes save their value:</span>
    <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="c1">#A number of special handles if the value is empty then save No known XXX</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;appearances&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">yat</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yat</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">attribute</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;allegiance&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">yat</span> <span class="o">=</span> <span class="s2">&quot;No known allegiance&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yat</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;culture&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">yat</span> <span class="o">=</span> <span class="s2">&quot;No known culture&quot;</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">yat</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Place = [[Haystack Hall&quot;</span> <span class="ow">or</span> <span class="n">y</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">yat</span> <span class="o">=</span> <span class="s1">&#39;Unknown status&#39;</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">yat</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yat</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span>
        
        <span class="c1">#Save the attribute in the property_dict for plotting:</span>
        <span class="n">property_dict</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yat</span><span class="p">)</span>   
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we have saved all the attributes and character names we are ready for plotting it. This will be done using <code>plotly</code> to make the figures interactive. All figures are saved in a dict so after making the figures we can visualize them one by one.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_property</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">property_dict</span><span class="p">,</span> <span class="n">orient</span> <span class="o">=</span> <span class="s2">&quot;columns&quot;</span><span class="p">)</span>

<span class="c1">#Allocate space for all dataframes and figures:</span>
<span class="n">dfs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">figs</span> <span class="o">=</span><span class="p">{}</span>

<span class="c1">#Iterate through all 5 attributes:</span>
<span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
    <span class="c1">#Count number of occurences of the categories for the given attribute:</span>
    <span class="n">dfs</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_property</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
    <span class="c1">#Reset index to have the attribute values as column instead of index:</span>
    <span class="n">dfs</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="c1">#Convert eg. status to Status for niceness in plot:</span>
    <span class="n">dfs</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">attribute</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="s2">&quot;Counts&quot;</span><span class="p">]</span>

    <span class="c1">#Special handling for appearances as we dont want to see zeros:</span>
    <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;appearances&#39;</span><span class="p">:</span>
        <span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;appearances&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;appearances&#39;</span><span class="p">][</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;appearances&#39;</span><span class="p">][</span><span class="s1">&#39;Appearances&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
    <span class="c1">#Make and save figure:</span>
    <span class="n">figs</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="n">attribute</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">attribute</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
             <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Counts&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">attribute</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Distribution of character &quot;</span><span class="o">+</span><span class="n">attribute</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, we are going to look at the plots one by one:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">figs</span><span class="p">[</span><span class="s2">&quot;religion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>From this it is apparent that a lot of the characters does not have a known religion, which is the majority of the characters, but if we toggle this of, we can see that the majority of the characters are part of <em>Faith of The Seven</em> and <em>Old Gods of the Forest</em>. On the other side it should be noted that the least frequent religions are <em>White Walkers</em> and <em>Ghiscari religion</em>. From the basic knowledge of the Game Of Thrones universe it also makes sense that the two most popular religions are <em>Faith of The Seven</em> and <em>Old Gods of the Forest</em> as the <em>The Seven Kingdoms</em> are practicing the <em>Faith of the Seven</em> whereas the people in the <em>North</em> are practicing the <em>Old Gods of the Forest</em>.</p>
<p>Further it should be noted that the the Game Of Thrones universe contains 8 different religions based on the <a href="https://gameofthrones.fandom.com/wiki/Game_of_Thrones_Wiki">Wiki pages</a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">figs</span><span class="p">[</span><span class="s2">&quot;allegiance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Again, some of the characters does not have an associated allegiance. The two most frequent allegiances are <em>House Stark</em> and <em>Hose Lannister</em>, followed by <em>Night's Watch</em> and <em>House Targaryen</em>. These allegiances are also the main allegiances in Game Of Thrones and further also the allegiances of the main characters in the series.</p>
<p><em>House Lannister</em> has characters as Cersei, Jamie and Tyrion whereas <em>House Stark</em> has Robb, Bran and the bastard Jon Snow. Jon Snow is one of the series most well known character which is also part of the <em>Night's Watch</em>, and the the <em>Night's Watch</em> are playing a big role later in the series when the battle against the <em>White Walkers</em> are happening. Lastly, <em>House Targaryen</em> are a house which is beaten down but as the series are evolving Daenerys are becoming a larger player in the universe as she conquers the world part by part.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">figs</span><span class="p">[</span><span class="s2">&quot;culture&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>From the above figure it can be seen that the most prominent culture are <em>Andals</em> followed by <em>Northmen</em>, again a large group has a unknown culture. From this it is apparent that most of the characters are found in the <em>Andals</em> and <em>Northmen</em> cultures, and makes the majority of the Game Of Thrones universe. Further, it should be noted that the universe contains a lot of small cultures such <em>Children of the Forest</em>.</p>
<p>The <em>Andals</em> are the people who invaded Westeros in the beginning of the universe, and are the dominant group. The <em>Northmen</em> are also a big cultural group defined by all the characters living in the North of the Game Of Thrones world.  The <em>Children of the Forest</em> are a small group of characters which are presented fairly late in the series. They are small non-human characters, and should be the original people of Westeros. Further it should be noticed that the network contains a lot of different cultures.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">figs</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>From the plot we can see that 121 characters dies throughout the series, and anyone who has seen the series would be able to confirm that a lot of characters die as the series progresses. In the figure below the distribution of the number of episode appearences can be seen.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">figs</span><span class="p">[</span><span class="s2">&quot;appearances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Again, a lot of characters do not have this attribute on their character page, and these observations have been omitted in the figure above. We can see that the majority of the characters only appear a couple of times ie. below 10-15 apperances. This would make sense as a lot of the characters are not main characters and therefore only appear in a season or likewise. We can further see a little group around 40 appearances and 60 appearances which could indicate we have a little group of characters appearing in most episodes, which would be expected as the series have a couple of main characters.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 align="center"> 2.2.2 Character dialogoue </h3><p>Next, we going to do some exploratory analysis of the character dialogoue. The dialogoue comes in a list of json objects, which each contains the information which episode, season it comes from. Each episode object does also contain a list of objects which contains a name of the character speaks and then the given dialogoue of the character.</p>
<p>We start out by loading the dialogoue from a github page.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/jeffreylancaster/game-of-thrones/master/data/script-bag-of-words.json&quot;</span><span class="p">)</span>
<span class="n">diag</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="c1">#Allocate space for character dialog:</span>
<span class="n">char_diag</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">char_count</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, we are going to pre-process the dialogoue into two dictionaries, namely a dictionary <code>char_diag</code> that contains the character name as a key, the value of the dictionary is the dialogoue of the character.</p>
<p>The other dictionary <code>char_count</code> contains the number of occurences for the given character at a season level and episode level. This are used to investigate the number of appearances of each character. Further, we are saving the length of the given character dialogoue.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">diag</span><span class="p">:</span>

    <span class="c1">#Extract season, episode number and the title of the episode:</span>
    <span class="n">episode</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;episodeNum&#39;</span><span class="p">]</span>
    <span class="n">season</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;seasonNum&#39;</span><span class="p">]</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;episodeTitle&#39;</span><span class="p">]</span>

    <span class="c1">#Create new object with the text:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
    <span class="c1">#Iterate through each object in the text object which contains all dialogoue of the episode:</span>
    <span class="k">for</span> <span class="n">textObj</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>

        <span class="c1">#If the character name are not in our character network then continue:</span>
        <span class="k">if</span> <span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">characters</span><span class="p">:</span> 
            <span class="k">continue</span> 
        <span class="c1">#If the character already are in the dictionary:</span>
        <span class="k">if</span> <span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">char_diag</span><span class="p">:</span>
            <span class="c1">#Then append text:</span>
            <span class="n">char_diag</span><span class="p">[</span><span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span>
            <span class="c1">#Put the episode into the character count dictionary - to keep track of which seasons and episodes:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">season</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;E&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">episode</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">char_count</span><span class="p">[</span><span class="n">textObj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]][</span><span class="s1">&#39;episodes&#39;</span><span class="p">]:</span>
                <span class="n">char_count</span><span class="p">[</span><span class="n">textObj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]][</span><span class="s1">&#39;episodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">season</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;E&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">episode</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">season</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">char_count</span><span class="p">[</span><span class="n">textObj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]][</span><span class="s1">&#39;seasons&#39;</span><span class="p">]:</span>
                <span class="n">char_count</span><span class="p">[</span><span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="s1">&#39;seasons&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">season</span><span class="p">)</span> 
            <span class="c1">#Save the length of the dialogoue:</span>
            <span class="n">char_count</span><span class="p">[</span><span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span><span class="c1">#If not already present in the object add it:</span>
            <span class="n">char_diag</span><span class="p">[</span><span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]]</span>
            <span class="n">char_count</span><span class="p">[</span><span class="n">textObj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;episodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">season</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;E&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">episode</span><span class="p">)],</span> <span class="s1">&#39;seasons&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">season</span><span class="p">],</span> <span class="s2">&quot;diag&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Having saved the data in two dictionaries we are going to convert the <code>char_count</code>into a dataframe which makes it more easy to plot afterwards.</p>
<p>Simultaneously, we count the number of unique occurences across episodes, seasons for each character.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_diag</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="c1">#Iterate through all characters:</span>
    <span class="p">{</span><span class="s2">&quot;character&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="n">char</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">char_count</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
    <span class="c1">#Count number of episodes the character are present in:</span>
    <span class="s1">&#39;Character episode count&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;episodes&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">char</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">char_count</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
    <span class="c1">#Count number of seasons the character are present in:</span>
     <span class="s1">&#39;Character season count&#39;</span><span class="p">:[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;seasons&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">char</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">char_count</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
     <span class="c1">#Add total dialogoue length for each character:</span>
     <span class="s1">&#39;Character diag length&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">char</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">char_count</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>    <span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We are now ready to plot the 3 dialogoue attributes, this are again done using <code>plotly</code> and are going to be done using bar-plots.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig_char_diag_len</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_diag</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Character diag length&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Character dialogoue length distribution&quot;</span><span class="p">)</span>
<span class="n">fig_char_diag_len</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;categoryorder&#39;</span><span class="p">:</span><span class="s1">&#39;total descending&#39;</span><span class="p">})</span>

<span class="n">fig_char_diag_len</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>From the figure above we can see that <em>Tyrion Lannister</em> clearly are the character with the longest dialogoue, which for anyone who has seen the series knows that Tyrion talks a lot and likes to talk. Next we can see that <em>Jon Snow</em>, <em>Cersei Lannister</em> and <em>Daenerys Targaryen</em> also has a lot of dialogoue. This makes sense as these three are part of the main characters, and appear in a lot of episodes.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig_char_season</span>  <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_diag</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Character season count&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Character appearances distribution (season level)&quot;</span><span class="p">)</span>
<span class="n">fig_char_season</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;categoryorder&#39;</span><span class="p">:</span><span class="s1">&#39;total descending&#39;</span><span class="p">})</span>

<span class="n">fig_char_season</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>From the figure above it can be seen that a lot of characters are present in all 8 season such as: <em>Jon Snow, Sansa Stark, Tyrion Lannister, Bronn and Samwell Tarly</em> and again this is expected as these characters are part of the key characters. On the other side a lot of characters are only present in 1 season such as <em>Syrio Forel</em> which is Arya Starks "dancing teacher" when she moves to King's Landing.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig_char_episode</span>  <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_diag</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Character episode count&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Character appearances distribution (episode level)&quot;</span><span class="p">)</span>
<span class="n">fig_char_episode</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;categoryorder&#39;</span><span class="p">:</span><span class="s1">&#39;total descending&#39;</span><span class="p">})</span>

<span class="n">fig_char_episode</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>From this we can see that the character which appear in most episodes are <em>Tyrion Lannister</em> followed by <em>Jon Snow, Sansa Stark, Daenerys Targaryen</em> which makes perfect sense as these characters are main characters. Only a couple of characters are present only ones which clearly would indicate they had a small role in the Game Of Thrones plot.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 align="center"> 2.2.3 Reviews and ratings </h3><p>As a last data-source we are looking into the reviews and ratings taken from IMDB, though using a python package (see earlier section) as it is illegal to scrape the IMDB webpage which we otherwise was looking into.</p>
<p>We are going to look into the average rating at episode and season level. Also we are looking into the demographics of the raters/reviewers, and lastly, what is the average review length for each episode/season.</p>
<p>We start out by loading the data which is saved in a <code>.json</code> file.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../data/imdb_reviews.json&quot;</span><span class="p">)</span>
<span class="n">ratings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">episode_rating</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">season_rating</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, we want to organize the data to ease the plotting afterwards. The ratings dictioanary is organized in a manner where the upper level key is the season, next the episode, and in each episode it contains the reviews and the ratings. This we want to extract and organize so it is more easy to plot.</p>
<p>We create two new dictionaries: one for storing the rating on season level and another for storing the rating on episode level.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">#Iterate through each season:</span>
<span class="k">for</span> <span class="n">season</span><span class="p">,</span> <span class="n">episodes</span> <span class="ow">in</span> <span class="n">ratings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">season_rating</span><span class="p">[</span><span class="s2">&quot;S&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#Iterate throug all episodes in this season:</span>
    <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">episodes</span><span class="p">:</span>
        <span class="c1">#Add rating:</span>
        <span class="n">season_rating</span><span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">episodes</span><span class="p">[</span><span class="n">episode</span><span class="p">][</span><span class="s1">&#39;ratings&#39;</span><span class="p">][</span><span class="s1">&#39;demographics&#39;</span><span class="p">][</span><span class="s1">&#39;imdb users&#39;</span><span class="p">][</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span>
        <span class="n">episode_rating</span><span class="p">[</span><span class="s2">&quot;S&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; E&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">=</span> <span class="n">episodes</span><span class="p">[</span><span class="n">episode</span><span class="p">][</span><span class="s1">&#39;ratings&#39;</span><span class="p">][</span><span class="s1">&#39;demographics&#39;</span><span class="p">][</span><span class="s1">&#39;imdb users&#39;</span><span class="p">][</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span>
        <span class="n">c</span><span class="o">+=</span> <span class="mi">1</span>
    <span class="c1">#Divide by number of episodes in this season:</span>
    <span class="n">season_rating</span><span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">season_rating</span><span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">/</span><span class="n">c</span>
    <span class="n">s</span><span class="o">+=</span><span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we have organized the data we are ready for investigating the average rating pr. season and episode.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_season_rating</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">season_rating</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="c1">#Reset index so we have a column named season instead:</span>
<span class="n">df_season_rating</span> <span class="o">=</span> <span class="n">df_season_rating</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_season_rating</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Season&#39;</span><span class="p">,</span> <span class="s2">&quot;IMDB rating&quot;</span><span class="p">]</span>
<span class="c1">#Plot it:</span>
<span class="n">fig_season_rating</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_season_rating</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Season&quot;</span><span class="p">,</span>
             <span class="n">y</span><span class="o">=</span><span class="s2">&quot;IMDB rating&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Season&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Rating pr. season&quot;</span><span class="p">)</span>
<span class="n">fig_season_rating</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we will look at the average rating pr. episode, to see if we could find any patterns. From the figure below we see approximately the same pattern as above, but we can now see that often the last 2 episodes in a season do achieve a higher average score compare to the middle episodes. Further it should be noticed that from the beginning of season 8 the episodes do keep getting lower average score, and the last episode in season 8 do achieve a quite low score of only 4.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_episode_rating</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">episode_rating</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="c1">#Reset index again:</span>
<span class="n">df_episode_rating</span> <span class="o">=</span> <span class="n">df_episode_rating</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_episode_rating</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Episode&#39;</span><span class="p">,</span> <span class="s2">&quot;IMDB rating&quot;</span><span class="p">]</span>

<span class="c1">#Plot:</span>
<span class="n">fig_episode_rating</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_episode_rating</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Episode&quot;</span><span class="p">,</span>
             <span class="n">y</span><span class="o">=</span><span class="s2">&quot;IMDB rating&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Episode&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Rating pr. episode&quot;</span><span class="p">)</span>
<span class="n">fig_episode_rating</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next part, investigate the demographics of the people who review and rate the Game Of Thrones series. In order to do this more easy we are going two create two functions for this.</p>
<p>One which extract the number of votes and rating sum, and another that reweights the rating.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">rating_weighted</span><span class="p">(</span><span class="n">cat_dist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that given a distribution of votes and rating_sum convert</span>
<span class="sd">    the rating into a weighted average</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cat_dist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1">#Iterate through each category and compute the weighted rating score:</span>
        <span class="n">cat_dist</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;rating_sum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;rating_sum&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;votes&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">cat_dist</span>

<span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">dict_item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that iterates through a dict and assign the number of votes and rating sum</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1">#If not in dict create the object:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_item</span><span class="p">:</span>
            <span class="n">dict_item</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;votes&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;rating_sum&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>

        <span class="c1">#Put values into dict:</span>
        <span class="n">dict_item</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;votes&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;votes&#39;</span><span class="p">]</span>
        <span class="n">dict_item</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;rating_sum&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;votes&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dict_item</span>

<span class="n">cat_dist</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1">#Iterate through each season:</span>
<span class="k">for</span> <span class="n">season</span><span class="p">,</span> <span class="n">episodes</span> <span class="ow">in</span> <span class="n">ratings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;S&quot;</span> <span class="o">+</span> <span class="n">season</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#Iterate through each episode in season:</span>
    <span class="k">for</span> <span class="n">c</span><span class="p">,(</span><span class="n">episode</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">episodes</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="s2">&quot;E&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="c1">#Get demographics iteM</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="n">season</span><span class="p">][</span><span class="n">episode</span><span class="p">][</span><span class="s1">&#39;ratings&#39;</span><span class="p">][</span><span class="s1">&#39;demographics&#39;</span><span class="p">]</span>
        <span class="c1">#Extract values into cat_dist dictionary:</span>
        <span class="n">cat_dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">cat_dist</span><span class="p">)</span>
<span class="c1">#Compute weighted average rating:</span>
<span class="n">cat_dist</span> <span class="o">=</span> <span class="n">rating_weighted</span><span class="p">(</span><span class="n">cat_dist</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we have organized our data in a more organized manner that makes it more easy to plot we are going to plot the demographics of the voters.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Aged under 18&quot;</span><span class="p">,</span> <span class="s2">&quot;Aged 18 29&quot;</span><span class="p">,</span><span class="s1">&#39;Aged 30 44&#39;</span><span class="p">,</span><span class="s1">&#39;Aged 45 plus&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
<span class="c1">#Categories for females:</span>
<span class="n">x_f</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;females aged under 18&#39;</span><span class="p">,</span> <span class="s1">&#39;females aged 18 29&#39;</span><span class="p">,</span> <span class="s1">&#39;females aged 30 44&#39;</span><span class="p">,</span><span class="s1">&#39;females aged 45 plus&#39;</span><span class="p">]</span>
<span class="c1">#Categories for men:</span>
<span class="n">x_m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;males aged under 18&#39;</span><span class="p">,</span> <span class="s1">&#39;males aged 18 29&#39;</span><span class="p">,</span> <span class="s1">&#39;males aged 30 44&#39;</span><span class="p">,</span><span class="s1">&#39;males aged 45 plus&#39;</span><span class="p">]</span>

<span class="c1">#Get the gender:</span>
<span class="n">gender</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="s1">&#39;female&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),[</span><span class="s1">&#39;male&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">x_gender</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x_f</span><span class="p">,</span> <span class="n">x_m</span><span class="p">))</span>

<span class="c1"># Extract number of votes:</span>
<span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat_dist</span><span class="p">[</span><span class="n">vote</span><span class="p">][</span><span class="s1">&#39;votes&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">vote</span> <span class="ow">in</span> <span class="n">x_gender</span><span class="p">]</span>

<span class="c1">#Extract average rating:</span>
<span class="n">ratings</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat_dist</span><span class="p">[</span><span class="n">vote</span><span class="p">][</span><span class="s1">&#39;rating_sum&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">vote</span> <span class="ow">in</span> <span class="n">x_gender</span><span class="p">]</span>

<span class="c1">#Convert into dictionary for easy plotting:</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;Category&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
    <span class="s2">&quot;Gender Category&quot;</span> <span class="p">:</span> <span class="n">x_gender</span><span class="p">,</span>
    <span class="s2">&quot;Gender&quot;</span> <span class="p">:</span> <span class="n">gender</span><span class="p">,</span>
    <span class="s2">&quot;Votes&quot;</span> <span class="p">:</span> <span class="n">v</span><span class="p">,</span>
    <span class="s2">&quot;Ratings&quot;</span> <span class="p">:</span> <span class="n">ratings</span>  
<span class="p">})</span>

<span class="c1">#Plot number of votes based on age and gender:</span>
<span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Category&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Votes&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Gender&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Distribution of number votes across age and gender&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Apperently the largest gender group is males which give votes, and the largest age group is age 30-44 whereas the smallest is under 18 years old. This would make sense as the series is restricted to 18 years or more. Further, it can be seen that people above age 45 does not tend to watch Game Of Thrones as much.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Females&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Ratings&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;female&#39;</span><span class="p">]),</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Males&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Ratings&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;male&#39;</span><span class="p">])</span>
<span class="p">])</span>
<span class="c1"># Change the bar mode</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">barmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Distribution of average rating across age and gender&quot;</span><span class="p">,</span> 
                    <span class="n">yaxis_title</span><span class="o">=</span> <span class="s2">&quot;Average IMDB rating&quot;</span><span class="p">,</span> <span class="n">xaxis_title</span> <span class="o">=</span> <span class="s2">&quot;Age category&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Generally the average IMDB rating are quite constant across the age and gender groups. The average rating are further quite high as the IMDB rating score goes from 0-10 and the average is above 8. The group that gives the series the lowest score are females under 18 years, but this group is also rather small so not many people need to give it a bad rating before this score gets affected by the ratings.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><h1 align ="center" >3. Tools, theory and analysis. Describe the process of theory to insight </h1></p>
<hr>
<p>This section is going to describe how we have approached the task of answering the following questions about the Game Of Thrones:</p>
<ul>
<li>Who is the main characters of each season of the series?</li>
<li>Is it possible to find a pattern in the data that helps understand the complicated world of Westeros?</li>
<li>Is the theme of the Game of Thrones series consistent throughout the show or does it change during it's course?</li>
</ul>
<p>This will be done first analysing the character network, next performing text analysis and lastly perform a community analysis. Therefore this section will be divided into three parts:</p>
<ul>
<li>Network analysis </li>
<li>Text analysis </li>
<li>Community analysis</li>
</ul>
<p>Each part is going to be introduced below, as well as the subconclusion of each part. Further, a link to a notebook doing the full analysis of each of the parts will be provided. This is done to make this notebook more convenient, and as the size otherwise would be to big to render on Github, and on most computers be extremely slow to read through.</p>
<h2 align = "center"> 3.1 Network analysis </h2><p>The Notebook going through the full analysis can be found <a href="https://github.com/MikkelMathiasen23/GameOfThrones_Network/tree/master/notebooks_final/08_01_network_analysis.ipynb">here</a>.</p>
<p>This part analyse the character interactions, do people tend to group in eg. allegiances? Or do they interact with people from other allegiances? Which character are main character in each season and across the whole series?</p>
<p>This is questions that this part of the analysis are going to dive into. The methods used for this part of the analysis are mainly network science tools such as degree distributions, centrality measures, assortivity and lastly, good old exploratory analysis and visualizations in general.</p>
<p>The main outputs from this analysis are two inteactive visualizations/apps that the end user can play around with. The first app are based on directed graphs, where the links between the characters (nodes) are extracted from the links between the character pages on the Game Of Thrones wiki-page. The network app can be visualized both pr. season and across each season, further it can be overlayed with different colormaps based on selected attribute.</p>
<p>The other main output are a interactive visualization/table where the out- and in degrees and centrality measure for each character are presented in a table and a graph, where one can tab through the seasons. This can help determine the importance of each of the characters in the selected season.</p>
<h3 align = "center"> 3.1.1 Subconclusion </h3><p>The resulting graph across all seasons were a very dense graph, and through different network analysis tools and by splitting into seasons it was possible to determine the most important characters in each season. Further, we found that the character attributes selected (religion, culture, allegiance, appearance and status) did not pose to be good measures to distinguish the characters. The characters were possibly connected base on another attribute or underlying pattern.</p>
<p>In the next sections we are going to investigate community analysis and hopefully this can help us reveal some of these patterns.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 align = "center"> 3.2 Text analysis </h2><p>The Notebook doing the full text analysis can be found <a href="https://github.com/MikkelMathiasen23/GameOfThrones_Network/tree/master/notebooks_final/08_02_text_analysis.ipynb">here</a>.</p>
<p align="center">
  <img src="https://blog.grabon.in/wp-content/uploads/2019/05/Got-Quote-Tyrion-Lannister.jpeg" />
</p><p>Do the theme of the Game Of Thrones change as the seasons goes by? Do characters and allegiances have specific words they use? Is it maybe possible to determine the mood of the characters throughout the series? This is some of the questions we try to answer and understand in this part of the analysis.</p>
<p>In order to dive into these questions the text analysis contains three parts namely:</p>
<ul>
<li>TF-IDF analysis </li>
<li>Sentiment analysis</li>
<li>Dispersion plot</li>
</ul>
<p>The text analysis are based on two data sources namely data extracted from the wiki-pages (ie. the character pages), and from the character dialogoue which is based on transcripts (see data section for more in depth description). In the TF-IDF we analyse the words used by each character, and compare the results between the character dialogoue and wiki-page. Further, we dive into whether the different allegiances has specific words they used compare to other. For both character and allegiance text analysis a few characters and allegiances are selected and compared. Further, we look into whether the theme changes throughout the seasons, and are done by looking into the words used in each season.</p>
<p>The results are presented in wordclouds in order to make it easy to grasp the information, and get an overview.</p>
<p>Further, in order to determine the mood of the characters we look into sentiment analysis, here two methods are utilized for the analysis: LabMT and VADER, which will be further explained in the linked notebook. Lastly, in order to look into whether the theme changes we are going to visualize a couple of selected words in a dispersion plot, to look into whether these change. A few words that are carefully selected are investigated.</p>
<h3 align = "center"> 3.2.1 Subconclusion </h3><p>Through the use of wordclouds it was possible to dive into the words used by a few selected characters and allegiances, and the extracted words clearly did explain these characters and allegiances. The words did also correspond well with the biased image of the characters and allegiances. Further, through the TF-IDF analysis of the seasons, we could see that the theme clearly changes as the series progress, and this was further backed up by the dispersion plot.</p>
<p>Lastly, by analysing the sentiment of the characters based on the dialogoue and wiki-pages that the dialogoue did contain larger variation in sentiment which would be expected as dialogoue would be expected to contain more polarizing words.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 align = "center"> 3.3 Community analysis </h2><p>The Notebook doing the full community analysis can be found <a href="(https://github.com/MikkelMathiasen23/GameOfThrones_Network/tree/master/notebooks_final/08_03_community_analysis.ipynb">here</a>).</p>
<p>What is the underlying pattern that connects the characters? This is the main question of this section. From the network analysis (in the previous part) it appeared that the underlying pattern connection the different characters was not primarily based on the selected attributes for each character. This section contains four parts which will dive into how the characters are connected. The sections are as follows:</p>
<ul>
<li>Community detection and exploratory analysis</li>
<li>Network analysis</li>
<li>TF-IDF</li>
<li>Sentiment analysis </li>
</ul>
<p>We utilzing the Louvain algorithm to detect communities in our character network, which we are going to perform some exploratory analysis on, and afterwards create an interactive network visualization/app same approach as in the Network analysis section. Afterwards, we are going to dive into the words characterizing these communities and lastly, looking into the sentiment.</p>
<h3 align = "center"> 3.3.1 Subconclusion </h3><p>The Louvain algorithm did extract six communities, and through the exploratory analysis it became clear that the characters were not grouped by their attributes (allegiance, religion etc.) but instead based on which people they were sourounded by. Daenarys Targaryen was a good example of this. Further when we looked into the community networks this became even more clear that this was the underlying pattern connecting these characters. Which seemed obvious when you think about it. We further analyzed the words of each community and this further backed up the hypothesis, and lastly the sentiment analysis that these communities clearly had different levels of sentiment.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 align= "center"> 4. Discussion </h1><hr>
<p>Our primary data source were the wiki-pages, and this proved to be a time consuming task to extract data from, due to a lot of human incosistencies and errors. This included multiple re-iterations of the regular expressions used to extract both character links, but also the attributes for each character. We did in the end after numerous attempts end up with a approach that appears to be mostly error free (we might find some when digging more into this), so we ended up with clean data. We did also discover that the information present for each character was very diverse and characters did contain different amount and quality of information, which needed to be handled.</p>
<p>In the beginning of the project we wished to add all the reviews from IMDB, which we in the beginning approached with web-scraping and used quite some time to set scripts and functions up to do this, but learned after some research that this was not allowed. We did therefore approach this by using a bult-in package in Python to extract these, but this showed to only extract 25 reviews pr. episode. After further analysis this showed not be enough as eg. the reviews and ratings not always appeared to be matching very well. We did therefore drop to use the reviews in this project, but we still think it could be interesting to investigate how sentiment of the reviews developed as the series progresses and compare this with the state of the (main) characters. Do we change our state of mood when the characters? Humans are said to mirror other humans, so this would be intersting to dive into.</p>
<p align="center">
  <img src="https://uproxx.com/wp-content/uploads/2019/04/brienne-jaime.jpg?w=650" />
</p><p>We especially think that our interactive visualization apps ie. the network app that enables the user to investigate the interactions season by season but also across the whole story went very well. This app contains enormous amount of information as one can get information about each character including the attributes, frequent used words, image and a link to the character page on the wiki-page. Further, the user can overlay the network with different attributes, and investigate patterns. At the same time we think the visualization are easy to understand without diving deep into the information.</p>
<p>The app describing the degrees and closeness centrality is also an element that we are proud of, as this can in an easy to grasp approach show what are the main character in each season. Also we are very proud of the large functionalities of this app, as the user can sort and delete features.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 align = "center"> 5. Future Work </h1><hr>
<p>The data only contained 165 characters as the primary data source used for the character was from the Game Of Thrones wikipage, which did not contain all the characters from the books. It would be interesting to further investigate the characters, their interactions, and some of the underlying patterns as there yet are a lot to dive into. The data could be supplied with further data from the books which can be found <a href="https://www.kaggle.com/mmmarchetti/game-of-thrones-network-analysis/data">here</a>.</p>
<p>This extensive dataset could add further complexity to the network analysis, and further the dialogoues used in this project could suplement information of the dialogoue of the majority of these characters. The dialogoue dataset contains more than 800 characters, and supplying the to date analysis with these elements could hopefully help reveal further interesting patterns of the Game Of Thrones story.</p>
<p align="center">
  <img src="https://quotedtext.com/wp-content/uploads/2020/06/game-of-thrones-quotes-by-tyrion-lannister-on-life-possibilities-1024x768.jpeg" width = 600 />
</p><h1 align = "center"> 6. Conclusion </h1><hr>
<p>To reiterate our goals of this project:</p>
<ul>
<li>Create a visually nice and interactive website</li>
<li>To perform network analysis and investigate of any patterns arises in the network attributes</li>
<li>Determine who was actually the main character of the story and it's respective seasons</li>
<li>Determine the overall sentiment of each character in the Game of Thrones series</li>
<li>Search for communities in the Game of Thrones network and establish if these communities makes sense from a story point of view</li>
</ul>
<hr>
<p>In conclusion, we, subjectively, think we succeeced in creating a visually pleasing website, with opportunities for the viewer to explore the extraced data and analysis themselves. This was done by utilizing interactive <em>Dash</em> applications hosted on <em>Heroku</em>. A lot of effort went into the making of the website content and it's formatting. In our network analysis it was possible to determine the most important characters of the show and it's respective seasons. This was achieved by investigating centrality measures and degree distributions. It was also concluded that the extracted attributes of religion, culture and allegiance did not pose to be good measures to distinguish the characters.</p>
<p>We did further analyse characters and their allegiances through use of text analysis, especially we focused on TF-IDF scores which we further visualized using wordclouds. This clearly established properties of each characters and their allegiances, and was in line with what was expected from our biased opinion. Further, we looked into whether the overall theme of the series changed through the seasons, which we investigated using TF-IDF analysis and dispersion plot, from here it was possible to see new patterns in theme which clearly changed through the story. As a last element on the text analysis we looked into sentiment analysis and could clearly find differences in the mood of the characters and as well we found that sentiment analysis appeared to have the best effect when used on dialogoue, where we could see larger variation in the sentiment across characters.</p>
<p>Lastly, as the character attributes did not pose as a good measure to distinguish the characters we performed community detection and found that the best way to split the characters was based on which other characters that sorrounded them. This conclusion can appear obvious, but nevertheless this was our finding from the analysis. We did further investigate the properties of these communities in these were clearly inline with the main result that the characters are best split into communities based on which characters they are sorrounded by.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 align = "center"> 7. Contributions </h1><hr>
<p>Both group members have contribute to all parts of the project.</p>
<p><strong>Introduction:</strong> Mikkel</p>
<p><strong>Data:</strong> Nicolai</p>
<p><strong>Basic statistics:</strong> Mikkel</p>
<p><strong>Network analysis:</strong> Nicolai</p>
<p><strong>Text analysis:</strong> Mikkel</p>
<p><strong>Community analysis:</strong> Nicolai</p>
<p><strong>Network app:</strong> Mikkel</p>
<p><strong>Table app:</strong> Nicolai</p>
<p><strong>Community app:</strong> Mikkel</p>
<p><strong>Main explainer notebook:</strong> Nicolai</p>
<p><strong>Network analysis explainer notebook:</strong> Mikkel</p>
<p><strong>Text analysis explainer notebook:</strong> Nicolai</p>
<p><strong>Community analysis explainer notebook:</strong> Mikkel</p>
<p><strong>Website:</strong> Nicolai</p>
<h1 align = "center"> 8. References </h1><hr>
<p><strong>Data sources:</strong></p>
<p>Game of thrones Wikipedia: <a href="https://gameofthrones.fandom.com/wiki/Game_of_Thrones_Wiki">https://gameofthrones.fandom.com/wiki/Game_of_Thrones_Wiki</a></p>
<p>Dialogoue data: <a href="https://github.com/jeffreylancaster/game-of-thrones#data">https://github.com/jeffreylancaster/game-of-thrones#data</a></p>
<p><strong>Plotting and visualization templates:</strong></p>
<p>Plotly: <a href="https://dash.plotly.com/">https://dash.plotly.com/</a></p>
<p>Heroku: <a href="https://towardsdatascience.com/deploying-your-dash-app-to-heroku-the-magical-guide-39bd6a0c586c">https://towardsdatascience.com/deploying-your-dash-app-to-heroku-the-magical-guide-39bd6a0c586c</a></p>
<p>Previous work in the 02805 Social Graphs and Interactions assignments</p>
<p><strong>Website:</strong></p>
<p>Fastai fastpages: <a href="https://github.com/fastai/fastpages">https://github.com/fastai/fastpages</a></p>
<p><strong>Network science:</strong></p>
<p>Design &amp; Data Visualization: Max Tillich, Kim Albrecht, Mauro Martino, Marton Posfai and Gabriele Musella.</p>
<p><strong>Sentiment analysis methods:</strong></p>
<p>VADER: <a href="https://github.com/cjhutto/vaderSentiment">https://github.com/cjhutto/vaderSentiment</a></p>
<p>LabMT: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4466725/">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4466725/</a></p>

</div>
</div>
</div>
</div>